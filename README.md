# Angular - Spring boot - Oauth2 connect - Golden project

Contents:
1. Frameworks
2. Architecture
3. Spring boot
	1. Servlet mappings
	2. Spring security
	3. Menu
4. Angular 
	1. Routes
	2. Guards
	3. Menu
	4. WebPack builder
	5. Development server
	6. Code scaffolding
	7. Build
	8. Further help
5. Making a build
	  

## Frameworks

- Angular 12
	- Angular Material
- Spring boot 5
	- Spring Security
- Gradle
- JSP (copied from src/assets/template to static/template after each angular build)

## Architecture

- User agent
Any modern web-browser

- Spring boot (port 8090)
- Keycloack (port 8080)
Keycloack oauth2 connect is configured in the application.yml. 

- NodeJs (for dev only port 4200)

## Spring boot

The spring initializr has been used to generate the initial project.
The configuration used was Gradle on Java, packaging jar, version 11

### Servlet mappings

To make angular work with spring boot, all defined routes should have a servlet mapping that loads the index page. It is assumed that every route has a defined menu item. Based on the menu configuration spring boot will initially map the angular controller to the different mappings. On the fly requests for URI's will be validated by the angular controller and if valid, forwarded to the index page.

### Spring security

Websecurity is configured in the WebSecurityConfig class.

By default static content and the default route are anonymously accessible toghether with index services. All other routes and services require user authorization.

The user authorities mapper is used to map keycloack roles to spring security roles.

Cors is configured such that the node.js server can fetch results from spring boot.

### Menu

The menu is configured in menu.yml.
Authorization is done based on the menu structure.

Each menu item can have:
- description
- uri (can be URL for external websites, isRoute must be set to false)
- role
- isRoute (true/false)
- children

if a menu item has children it should only have a description with an optional role.

## Angular

Angular project has been created with standard ng new and includes routing.
Default output goes to /static folder. Sourcemap is included by default.
Outputhashing is set to none to allow use of jsp page as html bootstrap.


### Routes

Routes are configured in app-routing.module and should have guard `SecurityGuard` when routes are not public. Each route should have a corresponding menu item. (see `spring/menu`)
e.g. 
```
  {
      path: 'intro',
      component: introComponent
      canActivate: [SecurityGuard]
  }
```

### Guards

Angular guards trigger the `isAllowed` service containing the route URI. The `isAllowed` service returns true or false based on the role defined in spring security.

### Menu

The dynamic-menu component contains a patch for the material-menu, menupatch directive is part of this patch. It is not sure if the patch works for material menu versions other then the one included here. 

### WebPack builder

The WebPack builder is used to copy some static resources to the static directory after each angular build.

----------------

Documentation generated by ng cli 

### Development server

Run `ng serve` for a dev server. Navigate to `http://localhost:4200/`. The app will automatically reload if you change any of the source files.

### Code scaffolding

Run `ng generate component component-name` to generate a new component. You can also use `ng generate directive|pipe|service|class|guard|interface|enum|module`.

### Build

Run `ng build` to build the project. The build artifacts will be stored in the `dist/` directory.

### Further help

To get more help on the Angular CLI use `ng help` or go check out the [Angular CLI Overview and Command Reference](https://angular.io/cli) page.

## Making a build

Prerequites:

- Gradle installed or use gradle wrapper 
- Angular Cli installed
- Started instance of keycloack

Required actions:

- ng build
- gradle bootWar
